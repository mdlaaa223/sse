# ================================================================================
# GitHub Workflow: Debug macOS - Acceso SSH instantÃ¡neo al Mac
# ================================================================================
# Este workflow proporciona acceso SSH instantÃ¡neo a un Mac de GitHub Actions
# usando tmate (terminal compartido). Ideal para depuraciÃ³n rÃ¡pida.
#
# Â¡Â¡ GRATIS - NO REQUIERE TARJETA DE CRÃ‰DITO !!
#
# CARACTERÃSTICAS:
# - Acceso SSH inmediato sin configuraciÃ³n adicional
# - Acceso web shell (navegador)
# - AutenticaciÃ³n con tu llave SSH de GitHub
# - Xcode 26.2 y .NET 10 preinstalados
#
# INSTRUCCIONES:
# 1. Ejecuta este workflow manualmente
# 2. Espera a que aparezcan las URLs en los logs
# 3. ConÃ©ctate vÃ­a SSH o web browser
# ================================================================================

name: ğŸš Debug macOS (SSH InstantÃ¡neo)

on:
  workflow_dispatch:
    inputs:
      install_dotnet_maui:
        description: 'Instalar .NET MAUI workloads'
        required: true
        default: true
        type: boolean
      session_timeout:
        description: 'Timeout si no hay conexiÃ³n (minutos)'
        required: true
        default: '30'
        type: choice
        options:
          - '15'
          - '30'
          - '60'
          - '120'

jobs:
  debug-macos:
    name: ğŸ SesiÃ³n SSH en macOS
    runs-on: macos-26
    timeout-minutes: 360
    
    steps:
      # ============================================
      # 1. Checkout
      # ============================================
      - name: Checkout Repository
        uses: actions/checkout@v4

      # ============================================
      # 2. InformaciÃ³n del sistema
      # ============================================
      - name: ğŸ“‹ InformaciÃ³n del Sistema
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "            INFORMACIÃ“N DEL MAC"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ–¥ï¸  macOS: $(sw_vers -productVersion)"
          echo "ğŸ”§ Xcode: $(xcodebuild -version | head -1)"
          echo "ğŸ”· .NET:  $(dotnet --version)"
          echo "ğŸ’» Arch:  $(uname -m)"
          echo ""

      # ============================================
      # 3. Seleccionar Xcode 26.2
      # ============================================
      - name: ğŸ”§ Configurar Xcode 26.2
        run: |
          if [ -d "/Applications/Xcode_26.2.app" ]; then
            sudo xcode-select -s /Applications/Xcode_26.2.app/Contents/Developer
            echo "âœ… Xcode 26.2 seleccionado"
          fi
          xcodebuild -version

      # ============================================
      # 4. Instalar MAUI (opcional)
      # ============================================
      - name: ğŸ“¦ Instalar .NET MAUI
        if: ${{ github.event.inputs.install_dotnet_maui == 'true' }}
        run: |
          echo "Instalando workloads de MAUI..."
          dotnet workload install maui
          echo "âœ… MAUI instalado"
          dotnet workload list

      # ============================================
      # 5. Iniciar sesiÃ³n tmate
      # ============================================
      - name: ğŸš Iniciar SesiÃ³n SSH (tmate)
        uses: mxschmitt/action-tmate@v3
        timeout-minutes: 360
        with:
          # Solo permite acceso al usuario que iniciÃ³ el workflow
          limit-access-to-actor: true
          # Tiempo de espera si nadie se conecta
          detached: false
        env:
          # Para continuar el workflow despuÃ©s de conectarte, ejecuta:
          # touch /home/runner/continue
          CONTINUE_FILE: /Users/runner/continue
